<% if current_user.has_role?(:admin) || current_user.has_role?('project manager') || current_user.has_role?(:agent) %>

  <div>
  <h3>Assigned Users</h3>
  <div class="flex flex-wrap gap-2 mt-2">
    <% if @ticket.users.any? %>
      <% @ticket.users.each do |user| %>
        <p class="border-b-4 border-r-2 border border-black dark:border-slate-100 p-2 min-w-3 gap-2 col-span-1 text-sm rounded">
          <% if user.name.present? %>
            <%= user.name %>
          <% else %>
            <%= truncate(user.email, length: 15, omission: '...') %>
          <% end %>
        </p>
      <% end %>
    <% else %>
      <p class="text-red-500 text-sm">
        No agents assigned. Please assign at least one agent to this ticket.
      </p>
    <% end %>
  </div>

    <div class="flex flex-wrap mt-2 gap-2">
      <div class="text-xs">
        <%= form_with url: assign_tag_project_ticket_path(@project, @ticket), local: true do %>
          <%= label_tag :user_id, "Select User" %>
          <div class="flex flex-wrap">
            <% available_users = User.with_assigned_role.where.not(id: @ticket.users.pluck(:id)).where(id: @project.users.pluck(:id)).distinct %>
            <% if available_users.any? %>
              <%= select_tag :user_id, options_from_collection_for_select(available_users, :id, :name || :email), class: " h-12 max-w-[120px] border border-[#3F8CFF] hover:border-[#3A81EB] border-2 rounded-lg mr-1" %>
              <div class="">
                <%= submit_tag "ASSIGN USER", class: 'mb-4 h-12 bg-[#3F8CFF] hover:bg-[#3A81EB] p-3 rounded font-bold rounded-lg text-slate-100' %>
              </div>
            <% else %>
              <p class="text-gray-500 text-sm">No available users to assign.</p>
            <% end %>
          </div>
        <% end %>
      </div>

      <% if @ticket.users.any? %>
        <div class="text-xs flex flex-wrap gap-2">
          <%= form_with url: unassign_tag_project_ticket_path(@project, @ticket), method: :delete, local: true do %>
            <%= label_tag :user_id, "REMOVE USER" %>
            <div class="flex flex-wrap">
              <%= select_tag :user_id, options_from_collection_for_select(@ticket.users, :id, :name), class: " h-12 max-w-[120px] border border-[#3F8CFF] hover:border-[#3A81EB] border-2 rounded-lg mr-1" %>
              <%= submit_tag "REMOVE", class: 'mb-4 h-12 bg-[#3F8CFF] hover:bg-[#3A81EB] p-3 rounded font-bold rounded-lg text-slate-100' %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

</div>
<% end %>

<!-- Dropdown Menu -->
<div class="relative inline-block text-left">
  <!-- Dropdown Button -->
  <button
    class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
    id="dropdown-button"
  >
    Current Projects
    <svg
      class="w-5 h-5 ml-2 -mr-1"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 20 20"
      fill="currentColor"
      aria-hidden="true"
    >
      <path
        fill-rule="evenodd"
        d="M5.293 7.707a1 1 0 011.414 0L10 11.414l3.293-3.707a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
        clip-rule="evenodd"
        />
    </svg>
  </button>

  <!-- Dropdown List -->
  <div
    class="absolute right-0 z-10 w-56 mt-2 origin-top-right bg-white border border-gray-200 divide-y divide-gray-100 rounded-md shadow-lg"
    role="menu"
    aria-orientation="vertical"
    aria-labelledby="dropdown-button"
  >
    <div class="py-1">
      <a
        href="#"
        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
        role="menuitem"
      >
        Current Projects
      </a>
      <a
        href="#"
        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
        role="menuitem"
      >
        Current Projects
      </a>
      <a
        href="#"
        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
        role="menuitem"
      >
        Current Projects
      </a>
    </div>
  </div>
</div>